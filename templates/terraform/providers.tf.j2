# WARNING
# This file is generated by render/ scripts and should not be edited directly.
#

terraform {
  required_providers {
    docker = {
      source  = "kreuzwerker/docker"
      version = "3.6.2"
    }
  }
}

# Dynamically Generated Docker Providers
{% for group_name, group_data in inventory.items() %}
{% if group_data.hosts %}
## {{ group_name  }} Servers
{% for host_name, host_vars in group_data.hosts.items() %}
{# --- Correctly check for key existence using 'in' --- #}
{% set ansible_host = host_vars['ansible_host'] if host_vars and 'ansible_host' in host_vars else host_name %}
{% set ansible_user = host_vars['ansible_user'] if host_vars and 'ansible_user' in host_vars else group_data.vars['ansible_user'] if group_data.vars and 'ansible_user' in group_data.vars else 'nxthdr' %}
provider "docker" {
  host     = "ssh://{{ ansible_user }}@{{ ansible_host }}:22"
  alias    = "{{ host_name }}"
  ssh_opts = ["-o", "StrictHostKeyChecking=no", "-o", "UserKnownHostsFile=/dev/null"]
}

{% endfor %}
{% endif %}
{% endfor %}
